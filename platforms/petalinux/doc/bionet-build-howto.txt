Compiling BioNetv2 for PetaLinux/Microblaze on MDACS

This is likely to change when the autotools (autoconf/automake) are integrated in BioNetv2 development environment, but for now this is the plan. Note, version numbers used are the latest versions available at the time of writing this document.

Download PetaLinux 0.30-rc1: http://developer.petalogix.com/#Download


Install PetaLinux 0.30-rc1 and set environment variables. I installed to /opt/petalinux and added this code to my .bashrc file:
##########
cd /opt/petalinux
source ./settings.sh
cd ~
export PATH=$PETALINUX/software/petalinux-dist/tools/ucfront:$PATH
##########


Directions to install PetaLinux are on their wiki: 
	http://developer.petalogix.com/wiki/InstallGuide/Procedure





See the bottom "Difficult" section if you do feel like going through all the pain.

cd trunk/platforms/petalinux/user-apps
./easy_build.sh



Difficult method:

Download the source code for the latest versions of glib (2.18.1), libdaemon (0.13), avahi (0.6.23), dbus (1.2.4), expat (2.0.1):
http://ftp.gnome.org/pub/gnome/sources/glib
http://0pointer.de/lennart/projects/libdaemon/
http://avahi.org/
http://www.freedesktop.org/wiki/Software/dbus
http://sourceforge.net/projects/expat/

Extract all of them to $PETALINUX/software/user-apps.


Avahi needs changes in order to compile under the PetaLinux toolchain. Add the following line to the beginning of functions avahi_open_socket_ipv6 and avahi_open_unicast_socket_ipv6 in avahi-core/socket.c:
#ifdef IPV6_V6ONLY
Don't forget to add a corresponding #endif at the end of those functions.

In the file avahi-daemon/static-services.c remove the lines:
#ifdef USE_EXPAT_H
#endif /* USE_EXPAT_H */
Add the line where the #endif was:
#include <expat_external.h>

In the configure script, remove these lines:
	XML_CFLAGS=-DUSE_EXPAT_H
	XML_LIBS=-lexpat


DBus also needs small changes. Change these lines in the configure script from 
   XML_LIBS=-lexpat
   XML_CFLAGS=
to
   XML_LIBS=$PETALINUX/software/petalinux-dist/expat/lib/libexpat.a
   XML_CFLAGS=-I$PETALINUX/software/petalinux-dist/expat/include


Make a directory for each of these to install:
mkdir $PETALINUX/software/petalinux-dist/avahi
mkdir $PETALINUX/software/petalinux-dist/dbus
mkdir $PETALINUX/software/petalinux-dist/expat
mkdir $PETALINUX/software/petalinux-dist/glib
mkdir $PETALINUX/software/petalinux-dist/libdaemon
mkdir $PETALINUX/software/petalinux-dist/bionet


Copy the *-easy_configure.sh scripts and *-mb.cache files into the respective directories and make the mb.cache file read-only.
example: 
	cp avahi-easy_configure.sh $PETALINUX/software/user-apps/avahi-0.6.23/easy_configure.sh
	cp avahi-mb.cache $PETALINUX/software/user-apps/avahi-0.6.23/mb.cache
	chmod a-w $PETALINUX/software/user-apps/avahi-0.6.23/mb.cache
	chmod a+x $PETALINUX/software/user-apps/avahi-0.6.23/easy_configure.sh
In order to compile them, you need to correctly set up the environment variables. This has been done for you in the easy_configure.sh scripts. Run these, then make, then make install.
Compile the libs in this order:
 - expat
 - libdaemon
 - dbus
 - glib
 - avahi 
 - bionet

Recurse into each of these directories and run:
./easy_configure.sh && make && make install


Install in the bionet directory does not yet work with this environment.


